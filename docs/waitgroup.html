<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code</title>
</head>
<body>
<h1>Implementing WaitGroup: Add and Done</h1>
<code><pre>type WaitGroup struct {
	count int // number of active goroutines
}

func (g *WaitGroup) Add(n int) {
	g.count += n
}

func (g *WaitGroup) Done() {
	g.count--
}

</pre></code>
<h1>Let&#39;s use atomics!</h1>
<code><pre>type WaitGroup struct {
	count atomic.Int64 // number of active goroutines
}

func (g *WaitGroup) Add(n int) {
	g.count.Add(int64(n))
}

func (g *WaitGroup) Done() {
	g.count.Add(-1)
}

</pre></code>
<h1>Atomic bomb</h1>
<code><pre>type WaitGroup struct {
	count atomic.Int64 // number of active goroutines
}

func (g *WaitGroup) Add(n int) {
	g.count.Add(int64(n))
}

func (g *WaitGroup) Done() {
	if g.count.Load() &lt;= 0 {
		panic(&#34;WaitGroup.Done called without a matching Add&#34;)
	}
	g.count.Add(-1)
}

</pre></code>
<h1>WaitGroup with Mutex</h1>
<code><pre>type WaitGroup struct {
	mu    sync.Mutex
	count int // number of active goroutines
}

func (g *WaitGroup) Add(n int) {
	g.mu.Lock()
	defer g.mu.Unlock()
	g.count += n
}

func (g *WaitGroup) Done() {
	g.mu.Lock()
	defer g.mu.Unlock()
	if g.count &lt;= 0 {
		panic(&#34;WaitGroup.Done called without a matching Add&#34;)
	}
	g.count--
}

</pre></code>
</body>
</html>
